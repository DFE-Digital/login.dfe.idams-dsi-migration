parameters:
 - name: applicationName
   type: string
 - name: environmentId
   type: string
 - name: environmentName
   type: string
 - name: location
   type: string
 - name: serviceConnection
   type: string
 - name: subscriptionId
   type: string
 - name: variableGroups
   type: object
 

jobs:
- deployment: packageAndDeploy
  displayName: 'Package and Deploy : ${{parameters.environmentName}}'
  environment: '${{parameters.environmentName}}'
  

- job: Deploy
  displayName: Deploy
  variables: 
  - name: applicationResourceGroupName
    value: '$(platformGlobalIdentifier)${{parameters.environmentId}}-${{parameters.applicationName}}'      
  steps:
   - task: AzurePowerShell@5
     displayName: Create ResourceGroup with tags
     inputs:
        azureSubscription: ${{parameters.serviceConnection}}
        ScriptType: 'InlineScript'
        Inline: 'New-AzResourceGroup -Name $(applicationResourceGroupName) -Location "${{parameters.location}}" -Tag $(Tags) -Force'
        azurePowerShellVersion: 'LatestVersion'
   - task: AzureFunctionApp@1
     displayName: 'Azure Function App Deploy'
     inputs:
        azureSubscription: 's141d-Pirean.azdo-deployment'
        appType: functionAppLinux
        appName: 's141d02-pirean-idamsuserimportapp'
        package: '$(Build.ArtifactStagingDirectory)/$(Build.BuildId).zip'
